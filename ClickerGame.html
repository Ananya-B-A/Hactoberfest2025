<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clicker Quest — Single File</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#7c3aed;
      --muted:#9aa4b2;
      --glass: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 400px at 10% 10%, rgba(124,58,237,0.12), transparent), var(--bg);color:#e6eef6}
    .wrap{max-width:980px;margin:28px auto;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:18px}
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between}
    .title{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#4c1d95);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;box-shadow:0 6px 20px rgba(0,0,0,0.6)}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}

    .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 6px 30px rgba(2,6,23,0.6);}

    /* Main play area */
    .play{display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;padding:22px}
    .big-button{width:260px;height:260px;border-radius:999px;background:var(--glass);display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer;user-select:none;box-shadow:inset 0 -10px 40px rgba(0,0,0,0.6), 0 6px 30px rgba(0,0,0,0.5);transition:transform .08s ease}
    .big-button:active{transform:scale(.98)}
    .big-count{font-size:44px;font-weight:800}
    .small-label{color:var(--muted);font-size:13px}

    .stats{display:flex;gap:12px;align-items:center}
    .stat{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));padding:8px 12px;border-radius:10px}
    .store{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .store-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));}
    .store-item button{background:linear-gradient(90deg,var(--accent),#5b21b6);border:0;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
    .store-item button:disabled{opacity:.5;cursor:not-allowed}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:var(--muted);cursor:pointer}

    /* Right column */
    .right{display:flex;flex-direction:column;gap:12px}
    .log{height:180px;overflow:auto;padding:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));border-radius:10px;font-size:13px;color:var(--muted)}

    footer{grid-column:1/-1;margin-top:8px;text-align:center;color:var(--muted);font-size:13px}

    /* small screens */
    @media (max-width:900px){.wrap{grid-template-columns:1fr;}.right{order:2}} 
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo">CQ</div>
        <div>
          <h1>Clicker Quest</h1>
          <div class="subtitle">Click to earn, buy upgrades, and build your empire</div>
        </div>
      </div>
      <div class="controls">
        <button id="saveBtn" class="ghost">Save</button>
        <button id="resetBtn" class="ghost">Reset</button>
        <button id="exportBtn" class="ghost">Export</button>
      </div>
    </header>

    <main class="card play">
      <div id="clicker" class="big-button" title="Click (or press space)">
        <div class="big-count" id="points">0</div>
        <div class="small-label" id="pps">0 per second • 1 per click</div>
      </div>

      <div class="stats">
        <div class="stat">Level: <strong id="level">1</strong></div>
        <div class="stat">Clicks: <strong id="totalClicks">0</strong></div>
        <div class="stat">Prestige: <strong id="prestige">0</strong></div>
      </div>

      <section class="store card" style="width:100%;margin-top:8px">
        <h3 style="margin:0 0 6px 0">Shop</h3>
        <div id="storeList"></div>
      </section>
    </main>

    <aside class="right">
      <div class="card">
        <h4 style="margin:0 0 8px 0">Activity Log</h4>
        <div id="log" class="log"></div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Export / Import</h4>
        <p style="color:var(--muted);font-size:13px;margin:0 0 8px 0">Export a save to copy or import it back to continue.</p>
        <textarea id="exportArea" style="width:100%;height:90px;border-radius:8px;padding:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="importBtn" class="ghost">Import</button>
          <button id="clearExport" class="ghost">Clear</button>
        </div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Tips</h4>
        <ul style="color:var(--muted);margin:0;padding-left:18px">
          <li>Press <strong>Space</strong> to click fast.</li>
          <li>Buy upgrades to increase per-click or automatic income.</li>
          <li>Saves automatically every 10s.</li>
        </ul>
      </div>
    </aside>

    <footer>Made with ❤️ • Local saves via <code>localStorage</code> • Try the Export to share your save</footer>
  </div>

  <script>
    // --- Game state ---
    const defaultState = {
      points: 0,
      totalClicks: 0,
      level: 1,
      prestige: 0,
      cps: 0, // clicks per second (auto)
      perClick: 1, // points per manual click
      upgrades: {
        cursor: 0,
        grandma: 0,
        factory: 0,
        multiplier: 0
      }
    };

    const STORE = [
      { id:'cursor', name:'Cursor', baseCost:12, type:'click', effect:{perClick:1} },
      { id:'grandma', name:'Grandma', baseCost:120, type:'cps', effect:{cps:1} },
      { id:'factory', name:'Factory', baseCost:1500, type:'cps', effect:{cps:10} },
      { id:'multiplier', name:'Multiplier', baseCost:1000, type:'mult', effect:{mult:2} }
    ];

    // load
    let state = load() || structuredClone(defaultState);

    // DOM refs
    const pointsEl = document.getElementById('points');
    const ppsEl = document.getElementById('pps');
    const levelEl = document.getElementById('level');
    const clicksEl = document.getElementById('totalClicks');
    const prestigeEl = document.getElementById('prestige');
    const storeList = document.getElementById('storeList');
    const log = document.getElementById('log');
    const clicker = document.getElementById('clicker');
    const exportArea = document.getElementById('exportArea');

    // helpers
    function fmt(n){return Math.floor(n).toLocaleString()}

    function save(){
      try{localStorage.setItem('clicker_save_v1', JSON.stringify(state));
        addLog('Game saved');
      }catch(e){console.warn('save failed',e)}
    }
    function load(){
      try{const s=localStorage.getItem('clicker_save_v1');return s?JSON.parse(s):null}catch(e){console.warn('load failed',e);return null}
    }

    function resetGame(){
      if(!confirm('Reset your game?')) return;
      state = structuredClone(defaultState);
      render();
      save();
      addLog('Game reset');
    }

    function addLog(txt){
      const el = document.createElement('div');
      const ts = new Date().toLocaleTimeString();
      el.textContent = `[${ts}] ${txt}`;
      log.prepend(el);
      // keep limited
      while(log.children.length>200) log.removeChild(log.lastChild);
    }

    // costs increase exponentially
    function costFor(itemId){
      const info = STORE.find(s=>s.id===itemId);
      const owned = state.upgrades[itemId]||0;
      const cost = Math.round(info.baseCost * Math.pow(1.15, owned));
      return cost;
    }

    function buy(itemId){
      const cost = costFor(itemId);
      if(state.points < cost) { addLog('Not enough points'); return false }
      state.points -= cost;
      state.upgrades[itemId] = (state.upgrades[itemId]||0) + 1;

      // apply upgrade effects
      const info = STORE.find(s=>s.id===itemId);
      if(info.type==='click'){
        state.perClick += info.effect.perClick;
      } else if(info.type==='cps'){
        state.cps += info.effect.cps;
      } else if(info.type==='mult'){
        // multiplier multiplies everything permanently by effect.mult
        state.perClick *= info.effect.mult;
        // scale cps too
        state.cps *= info.effect.mult;
      }
      addLog(`Bought ${info.name} (owned: ${state.upgrades[itemId]})`);
      renderStore();
      render();
      return true;
    }

    // clicking
    function doClick(){
      const gain = state.perClick;
      state.points += gain;
      state.totalClicks += 1;
      // small visual pop
      pulse(pointsEl);
      render();
    }

    // UI helpers
    function pulse(el){
      el.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:300});
    }

    // render
    function render(){
      pointsEl.textContent = fmt(state.points);
      ppsEl.textContent = `${(state.cps).toFixed(1)} per second • ${state.perClick.toFixed(1)} per click`;
      levelEl.textContent = state.level;
      clicksEl.textContent = fmt(state.totalClicks);
      prestigeEl.textContent = state.prestige;
      renderStore();
    }

    function renderStore(){
      storeList.innerHTML='';
      STORE.forEach(item=>{
        const owned = state.upgrades[item.id]||0;
        const cost = costFor(item.id);
        const row = document.createElement('div');
        row.className='store-item';
        row.innerHTML = `
          <div style="display:flex;gap:12px;align-items:center">
            <div style="width:44px;height:44px;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700">${item.name[0]}</div>
            <div>
              <div style="font-weight:700">${item.name} <span style="color:var(--muted);font-weight:500;font-size:12px">x${owned}</span></div>
              <div style="color:var(--muted);font-size:12px">${item.type==='cps'?`+${item.effect.cps} cps` : item.type==='click'?`+${item.effect.perClick} per click` : 'Multiply'}</div>
            </div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <div style="text-align:right;color:var(--muted);font-size:13px">${fmt(cost)}</div>
            <button ${state.points < cost ? 'disabled' : ''} data-id="${item.id}">Buy</button>
          </div>`;
        storeList.appendChild(row);
        row.querySelector('button').addEventListener('click', ()=> buy(item.id));
      })
    }

    // Auto loop: apply cps every 200ms in smaller ticks
    let lastTick = performance.now();
    function tick(time){
      const dt = (time - lastTick) / 1000; lastTick = time;
      // add cps * dt
      state.points += state.cps * dt;
      // level up logic: every 1000 points level++ (example)
      const needed = 1000 * state.level;
      if(state.points >= needed){
        state.points -= needed;
        state.level += 1;
        addLog(`Leveled up to ${state.level}!`);
      }
      render();
      requestAnimationFrame(tick);
    }

    // keyboard space to click
    window.addEventListener('keydown', (e)=>{
      if(e.code==='Space'){
        e.preventDefault(); doClick();
      }
    });

    // clicker mouse
    clicker.addEventListener('click', ()=> doClick());

    // save/export/import
    document.getElementById('saveBtn').addEventListener('click', save);
    document.getElementById('resetBtn').addEventListener('click', resetGame);
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      exportArea.value = btoa(unescape(encodeURIComponent(JSON.stringify(state))));
      addLog('Export created');
    });
    document.getElementById('importBtn').addEventListener('click', ()=>{
      const v = exportArea.value.trim();
      if(!v) { alert('Paste an export string first.'); return }
      try{
        const parsed = JSON.parse(decodeURIComponent(escape(atob(v))));
        state = parsed; render(); save(); addLog('Import successful');
      }catch(e){alert('Import failed - invalid data');}
    });
    document.getElementById('clearExport').addEventListener('click', ()=> exportArea.value='');

    // autosave
    setInterval(save, 10000);
    window.addEventListener('beforeunload', save);

    // initial render and start loop
    render();
    lastTick = performance.now();
    requestAnimationFrame(tick);

    // small helper: structuredClone polyfill for older browsers
    function structuredClone(obj){ return JSON.parse(JSON.stringify(obj)) }

    // show initial log
    addLog('Welcome to Clicker Quest — press Space or click the big circle!');
  </script>
</body>
</html>
